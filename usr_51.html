---
layout: vimdoc
helpname: 'usr_51'
---
<div id='vimCodeElement'>
<a class="Constant" href="usr_51.html" name="usr_51.txt">usr_51.txt</a>&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;<span class="Identifier">Vim version 9.0.</span>&nbsp;&nbsp;Last change: 2022 Jun 03<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VIM USER MANUAL - by Bram Moolenaar<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write plugins<br>
<br>
<br>
Plugins can be used to define settings for a specific type of file, syntax<br>
highlighting and many other things.&nbsp;&nbsp;This chapter explains how to write the<br>
most common Vim plugins.<br>
<br>
<a class="Identifier" href="usr_51.html#51.1">51.1</a>&nbsp;&nbsp;Writing a generic plugin<br>
<a class="Identifier" href="usr_51.html#51.2">51.2</a>&nbsp;&nbsp;Writing a filetype plugin<br>
<a class="Identifier" href="usr_51.html#51.3">51.3</a>&nbsp;&nbsp;Writing a compiler plugin<br>
<a class="Identifier" href="usr_51.html#51.4">51.4</a>&nbsp;&nbsp;Distributing Vim scripts<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp; Next chapter:&nbsp;<a class="Identifier" href="usr_52.html">usr_52.txt</a>&nbsp;&nbsp;Write large plugins<br>
&nbsp;Previous chapter:&nbsp;<a class="Identifier" href="usr_50.html">usr_50.txt</a>&nbsp;&nbsp;Advanced Vim script writing<br>
Table of contents:&nbsp;<a class="Identifier" href="usr_toc.html">usr_toc.txt</a><br>
<br>
<span class="PreProc">==============================================================================</span><br>
<a class="Constant" href="usr_51.html#51.1" name="51.1">51.1</a>&nbsp;&nbsp;Writing a generic plugin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="usr_51.html#write-plugin" name="write-plugin">write-plugin</a><br>
<br>
You can write a Vim script in such a way that many people can use it.&nbsp;&nbsp;This is<br>
called a plugin.&nbsp;&nbsp;Vim users can drop your script in their plugin directory and<br>
use its features right away&nbsp;<a class="Identifier" href="usr_05.html#add-plugin">add-plugin</a>.<br>
<br>
There are actually two types of plugins:<br>
<br>
&nbsp;&nbsp;global plugins: For all types of files.<br>
filetype plugins: Only for files of a specific type.<br>
<br>
In this section the first type is explained.&nbsp;&nbsp;Most items are also relevant for<br>
writing filetype plugins.&nbsp;&nbsp;The specifics for filetype plugins are in the next<br>
section&nbsp;<a class="Identifier" href="usr_51.html#write-filetype-plugin">write-filetype-plugin</a>.<br>
<br>
We will use&nbsp;<a class="Identifier" href="vim9.html#Vim9">Vim9</a>&nbsp;syntax here, the recommended way to write new plugins.<br>
Make sure the file starts with the&nbsp;<a class="Comment" href="vim9.html#vim9script">vim9script</a>&nbsp;command.<br>
<br>
<br>
NAME<br>
<br>
First of all you must choose a name for your plugin.&nbsp;&nbsp;The features provided<br>
by the plugin should be clear from its name.&nbsp;&nbsp;And it should be unlikely that<br>
someone else writes a plugin with the same name but which does something<br>
different.<br>
<br>
A script that corrects typing mistakes could be called &quot;typecorrect.vim&quot;.&nbsp;&nbsp;We<br>
will use it here as an example.<br>
<br>
For the plugin to work for everybody, it should follow a few guidelines.&nbsp;&nbsp;This<br>
will be explained step-by-step.&nbsp;&nbsp;The complete example plugin is at the end.<br>
<br>
<br>
BODY<br>
<br>
Let's start with the body of the plugin, the lines that do the actual work:<br>
<br>
<div class="helpExample">&nbsp;12&nbsp;&nbsp;&nbsp;&nbsp; iabbrev teh the<br>
&nbsp;13&nbsp;&nbsp;&nbsp;&nbsp; iabbrev otehr other<br>
&nbsp;14&nbsp;&nbsp;&nbsp;&nbsp; iabbrev wnat want<br>
&nbsp;15&nbsp;&nbsp;&nbsp;&nbsp; iabbrev synchronisation<br>
&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \ synchronization</div>
<br>
The actual list should be much longer, of course.<br>
<br>
The line numbers have only been added to explain a few things, don't put them<br>
in your plugin file!<br>
<br>
<br>
FIRST LINE<br>
<br>
<div class="helpExample">&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp; vim9script noclear</div>
<br>
You need to use&nbsp;<a class="Comment" href="vim9.html#vim9script">vim9script</a>&nbsp;as the very first command.&nbsp;&nbsp;Best is to put it in<br>
the very first line.<br>
<br>
The script we are writing will have a&nbsp;<a class="Comment" href="repeat.html#:finish">finish</a>&nbsp;command to bail out when it is<br>
loaded a second time.&nbsp;&nbsp;To avoid that the items defined in the script are lost<br>
the &quot;noclear&quot; argument is used.&nbsp;&nbsp;More info about this at&nbsp;<a class="Identifier" href="vim9.html#vim9-reload">vim9-reload</a>.<br>
<br>
<br>
HEADER<br>
<br>
You will probably add new corrections to the plugin and soon have several<br>
versions lying around.&nbsp;&nbsp;And when distributing this file, people will want to<br>
know who wrote this wonderful plugin and where they can send remarks.<br>
Therefore, put a header at the top of your plugin:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp; # Vim global plugin for correcting typing mistakes<br>
&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp; # Last Change:&nbsp;&nbsp;2021 Dec 30<br>
&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp; # Maintainer:&nbsp;&nbsp; Bram Moolenaar &lt;Bram@vim.org&gt;</div>
<br>
About copyright and licensing: Since plugins are very useful and it's hardly<br>
worth restricting their distribution, please consider making your plugin<br>
either public domain or use the Vim&nbsp;<a class="Identifier" href="uganda.html#license">license</a>.&nbsp;&nbsp;A short&nbsp;<span class="Todo">note</span>&nbsp;about this near<br>
the top of the plugin should be sufficient.&nbsp;&nbsp;Example:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp; # License:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This file is placed in the public domain.</div>
<br>
<br>
NOT LOADING<br>
<br>
It is possible that a user doesn't always want to load this plugin.&nbsp;&nbsp;Or the<br>
system administrator has dropped it in the system-wide plugin directory, but a<br>
user has their own plugin they want to use.&nbsp;&nbsp;Then the user must have a chance<br>
to disable loading this specific plugin.&nbsp;&nbsp;These lines will make it possible:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;7&nbsp;&nbsp;&nbsp;&nbsp; if exists(&quot;g:loaded_typecorrect&quot;)<br>
&nbsp;&nbsp;8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; finish<br>
&nbsp;&nbsp;9&nbsp;&nbsp;&nbsp;&nbsp; endif<br>
&nbsp;10&nbsp;&nbsp;&nbsp;&nbsp; g:loaded_typecorrect = 1</div>
<br>
This also avoids that when the script is loaded twice it would pointlessly<br>
redefine functions and cause trouble for autocommands that are added twice.<br>
<br>
The name is recommended to start with &quot;g:loaded_&quot; and then the file name of<br>
the plugin, literally.&nbsp;&nbsp;The &quot;g:&quot; is prepended to make the variable global, so<br>
that other places can check whether its functionality is available.&nbsp;&nbsp;Without<br>
&quot;g:&quot; it would be local to the script.<br>
<br>
Using&nbsp;<a class="Comment" href="repeat.html#:finish">finish</a>&nbsp;stops Vim from reading the rest of the file, it's much quicker<br>
than using if-endif around the whole file, since Vim would still need to parse<br>
the commands to find the&nbsp;<a class="Comment" href="eval.html#:endif">endif</a>.<br>
<br>
<br>
MAPPING<br>
<br>
Now let's make the plugin more interesting: We will add a mapping that adds a<br>
correction for the word under the cursor.&nbsp;&nbsp;We could just pick a key sequence<br>
for this mapping, but the user might already use it for something else.&nbsp;&nbsp;To<br>
allow the user to define which keys a mapping in a plugin uses, the&nbsp;<span class="Special">&lt;Leader&gt;</span><br>
item can be used:<br>
<br>
<div class="helpExample">&nbsp;20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; map &lt;unique&gt; &lt;Leader&gt;a&nbsp;&nbsp;&lt;Plug&gt;TypecorrAdd;</div>
<br>
The &quot;<span class="Special">&lt;Plug&gt;</span>TypecorrAdd;&quot; thing will do the work, more about that further on.<br>
<br>
The user can set the &quot;g:mapleader&quot; variable to the key sequence that they want<br>
plugin mappings to start with.&nbsp;&nbsp;Thus if the user has done:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g:mapleader = &quot;_&quot;</div>
<br>
the mapping will define &quot;_a&quot;.&nbsp;&nbsp;If the user didn't do this, the default value<br>
will be used, which is a backslash.&nbsp;&nbsp;Then a map for &quot;\a&quot; will be defined.<br>
<br>
<span class="Todo">Note</span>&nbsp;that&nbsp;<span class="Special">&lt;unique&gt;</span>&nbsp;is used, this will cause an error message if the mapping<br>
already happened to exist.&nbsp;<a class="Identifier" href="map.html#:map-<unique>">:map-&lt;unique&gt;</a><br>
<br>
But what if the user wants to define their own key sequence?&nbsp;&nbsp;We can allow<br>
that with this mechanism:<br>
<br>
<div class="helpExample">&nbsp;19&nbsp;&nbsp;&nbsp;&nbsp; if !hasmapto('&lt;Plug&gt;TypecorrAdd;')<br>
&nbsp;20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; map &lt;unique&gt; &lt;Leader&gt;a&nbsp;&nbsp;&lt;Plug&gt;TypecorrAdd;<br>
&nbsp;21&nbsp;&nbsp;&nbsp;&nbsp; endif</div>
<br>
This checks if a mapping to &quot;<span class="Special">&lt;Plug&gt;</span>TypecorrAdd;&quot; already exists, and only<br>
defines the mapping from &quot;<span class="Special">&lt;Leader&gt;</span>a&quot; if it doesn't.&nbsp;&nbsp;The user then has a<br>
chance of putting this in their vimrc file:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map ,c&nbsp;&nbsp;&lt;Plug&gt;TypecorrAdd;</div>
<br>
Then the mapped key sequence will be &quot;,c&quot; instead of &quot;_a&quot; or &quot;\a&quot;.<br>
<br>
<br>
PIECES<br>
<br>
If a script gets longer, you often want to break up the work in pieces.&nbsp;&nbsp;You<br>
can use functions or mappings for this.&nbsp;&nbsp;But you don't want these functions<br>
and mappings to interfere with the ones from other scripts.&nbsp;&nbsp;For example, you<br>
could define a function Add(), but another script could try to define the same<br>
function.&nbsp;&nbsp;To avoid this, we define the function local to the script.<br>
Fortunately, in&nbsp;<a class="Identifier" href="vim9.html#Vim9">Vim9</a>&nbsp;script this is the default.&nbsp;&nbsp;In a legacy script you<br>
would need to prefix the name with &quot;s:&quot;.<br>
<br>
We will define a function that adds a new typing correction:<br>
<br>
<div class="helpExample">&nbsp;28&nbsp;&nbsp;&nbsp;&nbsp; def Add(from: string, correct: bool)<br>
&nbsp;29&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var to = input($&quot;type the correction for {from}: &quot;)<br>
&nbsp;30&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exe $&quot;:iabbrev {from} {to}&quot;<br>
&nbsp;...<br>
&nbsp;34&nbsp;&nbsp;&nbsp;&nbsp; enddef</div>
<br>
Now we can call the function Add() from within this script.&nbsp;&nbsp;If another<br>
script also defines Add(), it will be local to that script and can only<br>
be called from that script.&nbsp;&nbsp;There can also be a global g:Add() function,<br>
which is again another function.<br>
<br>
<span class="Special">&lt;SID&gt;</span>&nbsp;can be used with mappings.&nbsp;&nbsp;It generates a script ID, which identifies<br>
the current script.&nbsp;&nbsp;In our typing correction plugin we use it like this:<br>
<br>
<div class="helpExample">&nbsp;22&nbsp;&nbsp;&nbsp;&nbsp; noremap &lt;unique&gt; &lt;script&gt; &lt;Plug&gt;TypecorrAdd;&nbsp;&nbsp;&lt;SID&gt;Add<br>
&nbsp;...<br>
&nbsp;26&nbsp;&nbsp;&nbsp;&nbsp; noremap &lt;SID&gt;Add&nbsp;&nbsp;:call &lt;SID&gt;Add(expand(&quot;&lt;cword&gt;&quot;), true)&lt;CR&gt;</div>
<br>
Thus when a user types &quot;\a&quot;, this sequence is invoked:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\a&nbsp;&nbsp;-&gt;&nbsp;&nbsp;&lt;Plug&gt;TypecorrAdd;&nbsp;&nbsp;-&gt;&nbsp;&nbsp;&lt;SID&gt;Add&nbsp;&nbsp;-&gt;&nbsp;&nbsp;:call &lt;SID&gt;Add(...)</div>
<br>
If another script also maps&nbsp;<span class="Special">&lt;SID&gt;</span>Add, it will get another script ID and<br>
thus define another mapping.<br>
<br>
<span class="Todo">Note</span>&nbsp;that instead of Add() we use&nbsp;<span class="Special">&lt;SID&gt;</span>Add() here.&nbsp;&nbsp;That is because the<br>
mapping is typed by the user, thus outside of the script context.&nbsp;&nbsp;The&nbsp;<span class="Special">&lt;SID&gt;</span><br>
is translated to the script ID, so that Vim knows in which script to look for<br>
the Add() function.<br>
<br>
This is a bit complicated, but it's required for the plugin to work together<br>
with other plugins.&nbsp;&nbsp;The basic rule is that you use&nbsp;<span class="Special">&lt;SID&gt;</span>Add() in mappings and<br>
Add() in other places (the script itself, autocommands, user commands).<br>
<br>
We can also add a menu entry to do the same as the mapping:<br>
<br>
<div class="helpExample">&nbsp;24&nbsp;&nbsp;&nbsp;&nbsp; noremenu &lt;script&gt; Plugin.Add\ Correction&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;SID&gt;Add</div>
<br>
The &quot;Plugin&quot; menu is recommended for adding menu items for plugins.&nbsp;&nbsp;In this<br>
case only one item is used.&nbsp;&nbsp;When adding more items, creating a submenu is<br>
recommended.&nbsp;&nbsp;For example, &quot;Plugin.CVS&quot; could be used for a plugin that offers<br>
CVS operations &quot;Plugin.CVS.checkin&quot;, &quot;Plugin.CVS.checkout&quot;, etc.<br>
<br>
<span class="Todo">Note</span>&nbsp;that in line 28 &quot;:noremap&quot; is used to avoid that any other mappings cause<br>
trouble.&nbsp;&nbsp;Someone may have remapped &quot;:call&quot;, for example.&nbsp;&nbsp;In line 24 we also<br>
use &quot;:noremap&quot;, but we do want &quot;<span class="Special">&lt;SID&gt;</span>Add&quot; to be remapped.&nbsp;&nbsp;This is why<br>
&quot;<span class="Special">&lt;script&gt;</span>&quot; is used here.&nbsp;&nbsp;This only allows mappings which are local to the<br>
script.&nbsp;<a class="Identifier" href="map.html#:map-<script>">:map-&lt;script&gt;</a>&nbsp;&nbsp;The same is done in line 26 for &quot;:noremenu&quot;.<br>
<a class="Identifier" href="gui.html#:menu-<script>">:menu-&lt;script&gt;</a><br>
<br>
<br>
<span class="Special">&lt;SID&gt;</span>&nbsp;AND&nbsp;<span class="Special">&lt;Plug&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="usr_51.html#using-<Plug>" name="using-&lt;Plug&gt;">using-&lt;Plug&gt;</a><br>
<br>
Both&nbsp;<span class="Special">&lt;SID&gt;</span>&nbsp;and&nbsp;<span class="Special">&lt;Plug&gt;</span>&nbsp;are used to avoid that mappings of typed keys interfere<br>
with mappings that are only to be used from other mappings.&nbsp;&nbsp;<span class="Todo">Note</span>&nbsp;the<br>
difference between using&nbsp;<span class="Special">&lt;SID&gt;</span>&nbsp;and&nbsp;<span class="Special">&lt;Plug&gt;</span>:<br>
<br>
<span class="Special">&lt;Plug&gt;</span>&nbsp;&nbsp;is visible outside of the script.&nbsp;&nbsp;It is used for mappings which the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user might want to map a key sequence to.&nbsp;&nbsp;<span class="Special">&lt;Plug&gt;</span>&nbsp;is a special code<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that a typed key will never produce.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;To make it very unlikely that other plugins use the same sequence of<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;characters, use this structure:&nbsp;<span class="Special">&lt;Plug&gt;</span>&nbsp;scriptname mapname<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In our example the scriptname is &quot;Typecorr&quot; and the mapname is &quot;Add&quot;.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We add a semicolon as the terminator.&nbsp;&nbsp;This results in<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;<span class="Special">&lt;Plug&gt;</span>TypecorrAdd;&quot;.&nbsp;&nbsp;Only the first character of scriptname and<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mapname is uppercase, so that we can see where mapname starts.<br>
<br>
<span class="Special">&lt;SID&gt;</span>&nbsp;&nbsp; is the script ID, a unique identifier for a script.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Internally Vim translates&nbsp;<span class="Special">&lt;SID&gt;</span>&nbsp;to &quot;<span class="Special">&lt;SNR&gt;</span>123_&quot;, where &quot;123&quot; can be any<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;number.&nbsp;&nbsp;Thus a function &quot;<span class="Special">&lt;SID&gt;</span>Add()&quot; will have a name &quot;<span class="Special">&lt;SNR&gt;</span>11_Add()&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in one script, and &quot;<span class="Special">&lt;SNR&gt;</span>22_Add()&quot; in another.&nbsp;&nbsp;You can see this if<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;you use the &quot;:function&quot; command to get a list of functions.&nbsp;&nbsp;The<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;translation of&nbsp;<span class="Special">&lt;SID&gt;</span>&nbsp;in mappings is exactly the same, that's how you<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;can call a script-local function from a mapping.<br>
<br>
<br>
USER COMMAND<br>
<br>
Now let's add a user command to add a correction:<br>
<br>
<div class="helpExample">&nbsp;36&nbsp;&nbsp;&nbsp;&nbsp; if !exists(&quot;:Correct&quot;)<br>
&nbsp;37&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; command -nargs=1&nbsp;&nbsp;Correct&nbsp;&nbsp;:call Add(&lt;q-args&gt;, false)<br>
&nbsp;38&nbsp;&nbsp;&nbsp;&nbsp; endif</div>
<br>
The user command is defined only if no command with the same name already<br>
exists.&nbsp;&nbsp;Otherwise we would get an error here.&nbsp;&nbsp;Overriding the existing user<br>
command with &quot;:command!&quot; is not a good idea, this would probably make the user<br>
wonder why the command they defined themselves doesn't work.&nbsp;&nbsp;<a class="Identifier" href="map.html#:command">:command</a><br>
If it did happen you can find out who to blame with:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verbose command Correct</div>
<br>
<br>
SCRIPT VARIABLES<br>
<br>
When a variable starts with &quot;s:&quot; it is a script variable.&nbsp;&nbsp;It can only be used<br>
inside a script.&nbsp;&nbsp;Outside the script it's not visible.&nbsp;&nbsp;This avoids trouble<br>
with using the same variable name in different scripts.&nbsp;&nbsp;The variables will be<br>
kept as long as Vim is running.&nbsp;&nbsp;And the same variables are used when sourcing<br>
the same script again.&nbsp;<a class="Identifier" href="eval.html#s:var">s:var</a><br>
<br>
The nice thing about&nbsp;<a class="Identifier" href="vim9.html#Vim9">Vim9</a>&nbsp;script is that variables are local to the script<br>
by default.&nbsp;&nbsp;You can prepend &quot;s:&quot; if you like, but you do not need to.&nbsp;&nbsp;And<br>
functions in the script can also use the script variables without a prefix<br>
(they must be declared before the function for this to work).<br>
<br>
Script-local variables can also be used in functions, autocommands and user<br>
commands that are defined in the script.&nbsp;&nbsp;Thus they are the perfect way to<br>
share information between parts of your plugin, without it leaking out.&nbsp;&nbsp;In<br>
our example we can add a few lines to count the number of corrections:<br>
<br>
<div class="helpExample">&nbsp;17&nbsp;&nbsp;&nbsp;&nbsp; var count = 4<br>
&nbsp;...<br>
&nbsp;28&nbsp;&nbsp;&nbsp;&nbsp; def Add(from: string, correct: bool)<br>
&nbsp;...<br>
&nbsp;32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; count += 1<br>
&nbsp;33&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo &quot;you now have &quot; .. count .. &quot; corrections&quot;<br>
&nbsp;34&nbsp;&nbsp;&nbsp;&nbsp; enddef</div>
<br>
&quot;count&quot; is declared and initialized to 4 in the script itself.&nbsp;&nbsp;When later<br>
the Add() function is called, it increments &quot;count&quot;.&nbsp;&nbsp;It doesn't matter from<br>
where the function was called, since it has been defined in the script, it<br>
will use the local variables from this script.<br>
<br>
<br>
THE RESULT<br>
<br>
Here is the resulting complete example:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp; vim9script noclear<br>
&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp; # Vim global plugin for correcting typing mistakes<br>
&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp; # Last Change:&nbsp;&nbsp;2021 Dec 30<br>
&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp; # Maintainer:&nbsp;&nbsp; Bram Moolenaar &lt;Bram@vim.org&gt;<br>
&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp; # License:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This file is placed in the public domain.<br>
&nbsp;&nbsp;6<br>
&nbsp;&nbsp;7&nbsp;&nbsp;&nbsp;&nbsp; if exists(&quot;g:loaded_typecorrect&quot;)<br>
&nbsp;&nbsp;8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; finish<br>
&nbsp;&nbsp;9&nbsp;&nbsp;&nbsp;&nbsp; endif<br>
&nbsp;10&nbsp;&nbsp;&nbsp;&nbsp; g:loaded_typecorrect = 1<br>
&nbsp;11<br>
&nbsp;12&nbsp;&nbsp;&nbsp;&nbsp; iabbrev teh the<br>
&nbsp;13&nbsp;&nbsp;&nbsp;&nbsp; iabbrev otehr other<br>
&nbsp;14&nbsp;&nbsp;&nbsp;&nbsp; iabbrev wnat want<br>
&nbsp;15&nbsp;&nbsp;&nbsp;&nbsp; iabbrev synchronisation<br>
&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \ synchronization<br>
&nbsp;17&nbsp;&nbsp;&nbsp;&nbsp; var count = 4<br>
&nbsp;18<br>
&nbsp;19&nbsp;&nbsp;&nbsp;&nbsp; if !hasmapto('&lt;Plug&gt;TypecorrAdd;')<br>
&nbsp;20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; map &lt;unique&gt; &lt;Leader&gt;a&nbsp;&nbsp;&lt;Plug&gt;TypecorrAdd;<br>
&nbsp;21&nbsp;&nbsp;&nbsp;&nbsp; endif<br>
&nbsp;22&nbsp;&nbsp;&nbsp;&nbsp; noremap &lt;unique&gt; &lt;script&gt; &lt;Plug&gt;TypecorrAdd;&nbsp;&nbsp;&lt;SID&gt;Add<br>
&nbsp;23<br>
&nbsp;24&nbsp;&nbsp;&nbsp;&nbsp; noremenu &lt;script&gt; Plugin.Add\ Correction&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;SID&gt;Add<br>
&nbsp;25<br>
&nbsp;26&nbsp;&nbsp;&nbsp;&nbsp; noremap &lt;SID&gt;Add&nbsp;&nbsp;:call &lt;SID&gt;Add(expand(&quot;&lt;cword&gt;&quot;), true)&lt;CR&gt;<br>
&nbsp;27<br>
&nbsp;28&nbsp;&nbsp;&nbsp;&nbsp; def Add(from: string, correct: bool)<br>
&nbsp;29&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var to = input(&quot;type the correction for &quot; .. from .. &quot;: &quot;)<br>
&nbsp;30&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exe &quot;:iabbrev &quot; .. from .. &quot; &quot; .. to<br>
&nbsp;31&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if correct | exe &quot;normal viws\&lt;C-R&gt;\&quot; \b\e&quot; | endif<br>
&nbsp;32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; count += 1<br>
&nbsp;33&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo &quot;you now have &quot; .. count .. &quot; corrections&quot;<br>
&nbsp;34&nbsp;&nbsp;&nbsp;&nbsp; enddef<br>
&nbsp;35<br>
&nbsp;36&nbsp;&nbsp;&nbsp;&nbsp; if !exists(&quot;:Correct&quot;)<br>
&nbsp;37&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; command -nargs=1&nbsp;&nbsp;Correct&nbsp;&nbsp;call Add(&lt;q-args&gt;, false)<br>
&nbsp;38&nbsp;&nbsp;&nbsp;&nbsp; endif</div>
<br>
Line 31 wasn't explained yet.&nbsp;&nbsp;It applies the new correction to the word under<br>
the cursor.&nbsp;&nbsp;The&nbsp;<a class="Identifier" href="various.html#:normal">:normal</a>&nbsp;command is used to use the new abbreviation.&nbsp;&nbsp;<span class="Todo">Note</span><br>
that mappings and abbreviations are expanded here, even though the function<br>
was called from a mapping defined with &quot;:noremap&quot;.<br>
<br>
<br>
<span class="Statement">DOCUMENTATION&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a class="Constant" href="usr_51.html#write-local-help" name="write-local-help">write-local-help</a><br>
<br>
It's a good idea to also write some documentation for your plugin.&nbsp;&nbsp;Especially<br>
when its behavior can be changed by the user.&nbsp;&nbsp;See&nbsp;<a class="Identifier" href="usr_05.html#add-local-help">add-local-help</a>&nbsp;for how<br>
they are installed.<br>
<br>
Here is a simple example for a plugin help file, called &quot;typecorrect.txt&quot;:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp; *typecorrect.txt*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Plugin for correcting typing mistakes<br>
&nbsp;&nbsp;2<br>
&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp; If you make typing mistakes, this plugin will have them corrected<br>
&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp; automatically.<br>
&nbsp;&nbsp;5<br>
&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp; There are currently only a few corrections.&nbsp;&nbsp;Add your own if you like.<br>
&nbsp;&nbsp;7<br>
&nbsp;&nbsp;8&nbsp;&nbsp;&nbsp;&nbsp; Mappings:<br>
&nbsp;&nbsp;9&nbsp;&nbsp;&nbsp;&nbsp; &lt;Leader&gt;a&nbsp;&nbsp; or&nbsp;&nbsp; &lt;Plug&gt;TypecorrAdd;<br>
&nbsp;10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Add a correction for the word under the cursor.<br>
&nbsp;11<br>
&nbsp;12&nbsp;&nbsp;&nbsp;&nbsp; Commands:<br>
&nbsp;13&nbsp;&nbsp;&nbsp;&nbsp; :Correct {word}<br>
&nbsp;14&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Add a correction for {word}.<br>
&nbsp;15<br>
&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *typecorrect-settings*<br>
&nbsp;17&nbsp;&nbsp;&nbsp;&nbsp; This plugin doesn't have any settings.</div>
<br>
The first line is actually the only one for which the format matters.&nbsp;&nbsp;It will<br>
be extracted from the help file to be put in the &quot;LOCAL ADDITIONS:&quot; section of<br>
help.txt&nbsp;<a class="Identifier" href="index.html#local-additions">local-additions</a>.&nbsp;&nbsp;The first &quot;*&quot; must be in the first column of the<br>
first line.&nbsp;&nbsp;After adding your help file do &quot;:help&quot; and check that the entries<br>
line up nicely.<br>
<br>
You can add more tags inside ** in your help file.&nbsp;&nbsp;But be careful not to use<br>
existing help tags.&nbsp;&nbsp;You would probably use the name of your plugin in most of<br>
them, like &quot;typecorrect-settings&quot; in the example.<br>
<br>
Using references to other parts of the help in || is recommended.&nbsp;&nbsp;This makes<br>
it easy for the user to find associated help.<br>
<br>
<br>
<span class="Statement">SUMMARY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a class="Constant" href="usr_51.html#plugin-special" name="plugin-special">plugin-special</a><br>
<br>
Summary of special things to use in a plugin:<br>
<br>
var name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Variable local to the script.<br>
<br>
<span class="Special">&lt;SID&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Script-ID, used for mappings and functions local to<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the script.<br>
<br>
hasmapto()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Function to test if the user already defined a mapping<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for functionality the script offers.<br>
<br>
<span class="Special">&lt;Leader&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Value of &quot;mapleader&quot;, which the user defines as the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keys that plugin mappings start with.<br>
<br>
map&nbsp;<span class="Special">&lt;unique&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Give a warning if a mapping already exists.<br>
<br>
noremap&nbsp;<span class="Special">&lt;script&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Use only mappings local to the script, not global<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mappings.<br>
<br>
exists(&quot;:Cmd&quot;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Check if a user command already exists.<br>
<br>
<span class="PreProc">==============================================================================</span><br>
<a class="Constant" href="usr_51.html#51.2" name="51.2">51.2</a>&nbsp;&nbsp;Writing a filetype plugin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="usr_51.html#write-filetype-plugin" name="write-filetype-plugin">write-filetype-plugin</a>&nbsp;<a class="Constant" href="usr_51.html#ftplugin" name="ftplugin">ftplugin</a><br>
<br>
A filetype plugin is like a global plugin, except that it sets options and<br>
defines mappings for the current buffer only.&nbsp;&nbsp;See&nbsp;<a class="Identifier" href="usr_05.html#add-filetype-plugin">add-filetype-plugin</a>&nbsp;for<br>
how this type of plugin is used.<br>
<br>
First read the section on global plugins above&nbsp;<a class="Identifier" href="usr_51.html#51.1">51.1</a>.&nbsp;&nbsp;All that is said there<br>
also applies to filetype plugins.&nbsp;&nbsp;There are a few extras, which are explained<br>
here.&nbsp;&nbsp;The essential thing is that a filetype plugin should only have an<br>
effect on the current buffer.<br>
<br>
<br>
DISABLING<br>
<br>
If you are writing a filetype plugin to be used by many people, they need a<br>
chance to disable loading it.&nbsp;&nbsp;Put this at the top of the plugin:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Only do this when not done yet for this buffer<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if exists(&quot;b:did_ftplugin&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;finish<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b:did_ftplugin = 1</div>
<br>
This also needs to be used to avoid that the same plugin is executed twice for<br>
the same buffer (happens when using an &quot;:edit&quot; command without arguments).<br>
<br>
Now users can disable loading the default plugin completely by making a<br>
filetype plugin with only these lines:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b:did_ftplugin = 1</div>
<br>
This does require that the filetype plugin directory comes before $VIMRUNTIME<br>
in&nbsp;<a class="Type" href="options.html#'runtimepath'">'runtimepath'</a>!<br>
<br>
If you do want to use the default plugin, but overrule one of the settings,<br>
you can write the different setting in a script:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setlocal textwidth=70</div>
<br>
Now write this in the &quot;after&quot; directory, so that it gets sourced after the<br>
distributed &quot;vim.vim&quot; ftplugin&nbsp;<a class="Identifier" href="options.html#after-directory">after-directory</a>.&nbsp;&nbsp;For Unix this would be<br>
&quot;~/.vim/after/ftplugin/vim.vim&quot;.&nbsp;&nbsp;<span class="Todo">Note</span>&nbsp;that the default plugin will have set<br>
&quot;b:did_ftplugin&quot;, it is ignored here.<br>
<br>
<br>
OPTIONS<br>
<br>
To make sure the filetype plugin only affects the current buffer use the<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setlocal</div>
<br>
command to set options.&nbsp;&nbsp;And only set options which are local to a buffer (see<br>
the help for the option to check that).&nbsp;&nbsp;When using&nbsp;<a class="Comment" href="options.html#:setlocal">:setlocal</a>&nbsp;for global<br>
options or options local to a window, the value will change for many buffers,<br>
and that is not what a filetype plugin should do.<br>
<br>
When an option has a value that is a list of flags or items, consider using<br>
&quot;+=&quot; and &quot;-=&quot; to keep the existing value.&nbsp;&nbsp;Be aware that the user may have<br>
changed an option value already.&nbsp;&nbsp;First resetting to the default value and<br>
then changing it is often a good idea.&nbsp;&nbsp;Example:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setlocal formatoptions&amp; formatoptions+=ro</div>
<br>
<br>
MAPPINGS<br>
<br>
To make sure mappings will only work in the current buffer use the<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map &lt;buffer&gt;</div>
<br>
command.&nbsp;&nbsp;This needs to be combined with the two-step mapping explained above.<br>
An example of how to define functionality in a filetype plugin:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if !hasmapto('&lt;Plug&gt;JavaImport;')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map &lt;buffer&gt; &lt;unique&gt; &lt;LocalLeader&gt;i &lt;Plug&gt;JavaImport;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noremap &lt;buffer&gt; &lt;unique&gt; &lt;Plug&gt;JavaImport; oimport &quot;&quot;&lt;Left&gt;&lt;Esc&gt;</div>
<br>
<a class="Identifier" href="builtin.html#hasmapto()">hasmapto()</a>&nbsp;is used to check if the user has already defined a map to<br>
<span class="Special">&lt;Plug&gt;</span>JavaImport;.&nbsp;&nbsp;If not, then the filetype plugin defines the default<br>
mapping.&nbsp;&nbsp;This starts with&nbsp;<a class="Identifier" href="map.html#<LocalLeader>">&lt;LocalLeader&gt;</a>, which allows the user to select<br>
the key(s) they want filetype plugin mappings to start with.&nbsp;&nbsp;The default is a<br>
backslash.<br>
&quot;<span class="Special">&lt;unique&gt;</span>&quot; is used to give an error message if the mapping already exists or<br>
overlaps with an existing mapping.<br>
<a class="Identifier" href="map.html#:noremap">:noremap</a>&nbsp;is used to avoid that any other mappings that the user has defined<br>
interferes.&nbsp;&nbsp;You might want to use &quot;:noremap&nbsp;<span class="Special">&lt;script&gt;</span>&quot; to allow remapping<br>
mappings defined in this script that start with&nbsp;<span class="Special">&lt;SID&gt;</span>.<br>
<br>
The user must have a chance to disable the mappings in a filetype plugin,<br>
without disabling everything.&nbsp;&nbsp;Here is an example of how this is done for a<br>
plugin for the mail filetype:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Add mappings, unless the user didn't want this.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if !exists(&quot;g:no_plugin_maps&quot;) &amp;&amp; !exists(&quot;g:no_mail_maps&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Quote text by inserting &quot;&gt; &quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if !hasmapto('&lt;Plug&gt;MailQuote;')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vmap &lt;buffer&gt; &lt;LocalLeader&gt;q &lt;Plug&gt;MailQuote;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nmap &lt;buffer&gt; &lt;LocalLeader&gt;q &lt;Plug&gt;MailQuote;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vnoremap &lt;buffer&gt; &lt;Plug&gt;MailQuote; :s/^/&gt; /&lt;CR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nnoremap &lt;buffer&gt; &lt;Plug&gt;MailQuote; :.,$s/^/&gt; /&lt;CR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif</div>
<br>
Two global variables are used:<br>
<a class="Identifier" href="filetype.html#g:no_plugin_maps">g:no_plugin_maps</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;disables mappings for all filetype plugins<br>
<a class="Identifier" href="filetype.html#g:no_mail_maps">g:no_mail_maps</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;disables mappings for the &quot;mail&quot; filetype<br>
<br>
<br>
USER COMMANDS<br>
<br>
To add a user command for a specific file type, so that it can only be used in<br>
one buffer, use the &quot;-buffer&quot; argument to&nbsp;<a class="Identifier" href="map.html#:command">:command</a>.&nbsp;&nbsp;Example:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command -buffer&nbsp;&nbsp;Make&nbsp;&nbsp;make %:r.s</div>
<br>
<br>
VARIABLES<br>
<br>
A filetype plugin will be sourced for each buffer of the type it's for.&nbsp;&nbsp;Local<br>
script variables will be shared between all invocations.&nbsp;&nbsp;Use local buffer<br>
variables&nbsp;<a class="Identifier" href="eval.html#b:var">b:var</a>&nbsp;if you want a variable specifically for one buffer.<br>
<br>
<br>
FUNCTIONS<br>
<br>
When defining a function, this only needs to be done once.&nbsp;&nbsp;But the filetype<br>
plugin will be sourced every time a file with this filetype will be opened.<br>
This construct makes sure the function is only defined once:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if !exists(&quot;*Func&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Func(arg)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif</div>
<br>
Don't forget to use &quot;noclear&quot; with the&nbsp;<a class="Comment" href="vim9.html#vim9script">vim9script</a>&nbsp;command to avoid that the<br>
function is deleted when the script is sourced a second time.<br>
<br>
<br>
<span class="Statement">UNDO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a class="Constant" href="usr_51.html#undo_indent" name="undo_indent">undo_indent</a>&nbsp;<a class="Constant" href="usr_51.html#undo_ftplugin" name="undo_ftplugin">undo_ftplugin</a><br>
<br>
When the user does &quot;:setfiletype xyz&quot; the effect of the previous filetype<br>
should be undone.&nbsp;&nbsp;Set the b:undo_ftplugin variable to the commands that will<br>
undo the settings in your filetype plugin.&nbsp;&nbsp;Example:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b:undo_ftplugin = &quot;setlocal fo&lt; com&lt; tw&lt; commentstring&lt;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\ .. &quot;| unlet b:match_ignorecase b:match_words b:match_skip&quot;</div>
<br>
Using &quot;:setlocal&quot; with &quot;&lt;&quot; after the option name resets the option to its<br>
global value.&nbsp;&nbsp;That is mostly the best way to reset the option value.<br>
<br>
For undoing the effect of an indent script, the b:undo_indent variable should<br>
be set accordingly.<br>
<br>
Both these variables use legacy script syntax, not&nbsp;<a class="Identifier" href="vim9.html#Vim9">Vim9</a>&nbsp;syntax.<br>
<br>
<br>
FILE NAME<br>
<br>
The filetype must be included in the file name&nbsp;<a class="Identifier" href="usr_05.html#ftplugin-name">ftplugin-name</a>.&nbsp;&nbsp;Use one of<br>
these three forms:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.../ftplugin/stuff.vim<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.../ftplugin/stuff_foo.vim<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.../ftplugin/stuff/bar.vim<br>
<br>
&quot;stuff&quot; is the filetype, &quot;foo&quot; and &quot;bar&quot; are arbitrary names.<br>
<br>
<br>
<span class="Statement">FILETYPE DETECTION&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a class="Constant" href="usr_51.html#plugin-filetype" name="plugin-filetype">plugin-filetype</a><br>
<br>
If your filetype is not already detected by Vim, you should create a filetype<br>
detection snippet in a separate file.&nbsp;&nbsp;It is usually in the form of an<br>
autocommand that sets the filetype when the file name matches a pattern.<br>
Example:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;au BufNewFile,BufRead *.foo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; setlocal filetype=foofoo</div>
<br>
Write this single-line file as &quot;ftdetect/foofoo.vim&quot; in the first directory<br>
that appears in&nbsp;<a class="Type" href="options.html#'runtimepath'">'runtimepath'</a>.&nbsp;&nbsp;For Unix that would be<br>
&quot;~/.vim/ftdetect/foofoo.vim&quot;.&nbsp;&nbsp;The convention is to use the name of the<br>
filetype for the script name.<br>
<br>
You can make more complicated checks if you like, for example to inspect the<br>
contents of the file to recognize the language.&nbsp;&nbsp;Also see&nbsp;<a class="Identifier" href="filetype.html#new-filetype">new-filetype</a>.<br>
<br>
<br>
<span class="Statement">SUMMARY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a class="Constant" href="usr_51.html#ftplugin-special" name="ftplugin-special">ftplugin-special</a><br>
<br>
Summary of special things to use in a filetype plugin:<br>
<br>
<span class="Special">&lt;LocalLeader&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Value of &quot;maplocalleader&quot;, which the user defines as<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the keys that filetype plugin mappings start with.<br>
<br>
map&nbsp;<span class="Special">&lt;buffer&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Define a mapping local to the buffer.<br>
<br>
noremap&nbsp;<span class="Special">&lt;script&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Only remap mappings defined in this script that start<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;<span class="Special">&lt;SID&gt;</span>.<br>
<br>
setlocal&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set an option for the current buffer only.<br>
<br>
command -buffer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Define a user command local to the buffer.<br>
<br>
exists(&quot;*s:Func&quot;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Check if a function was already defined.<br>
<br>
Also see&nbsp;<a class="Identifier" href="usr_51.html#plugin-special">plugin-special</a>, the special things used for all plugins.<br>
<br>
<span class="PreProc">==============================================================================</span><br>
<a class="Constant" href="usr_51.html#51.3" name="51.3">51.3</a>&nbsp;&nbsp;Writing a compiler plugin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="usr_51.html#write-compiler-plugin" name="write-compiler-plugin">write-compiler-plugin</a><br>
<br>
A compiler plugin sets options for use with a specific compiler.&nbsp;&nbsp;The user can<br>
load it with the&nbsp;<a class="Identifier" href="quickfix.html#:compiler">:compiler</a>&nbsp;command.&nbsp;&nbsp;The main use is to set the<br>
<a class="Type" href="options.html#'errorformat'">'errorformat'</a>&nbsp;and&nbsp;<a class="Type" href="options.html#'makeprg'">'makeprg'</a>&nbsp;options.<br>
<br>
Easiest is to have a look at examples.&nbsp;&nbsp;This command will edit all the default<br>
compiler plugins:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next $VIMRUNTIME/compiler/*.vim</div>
<br>
Type&nbsp;<a class="Comment" href="editing.html#:next">:next</a>&nbsp;to go to the next plugin file.<br>
<br>
There are two special items about these files.&nbsp;&nbsp;First is a mechanism to allow<br>
a user to overrule or add to the default file.&nbsp;&nbsp;The default files start with:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if exists(&quot;g:current_compiler&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;finish<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g:current_compiler = &quot;mine&quot;</div>
<br>
When you write a compiler file and put it in your personal runtime directory<br>
(e.g., ~/.vim/compiler for Unix), you set the &quot;current_compiler&quot; variable to<br>
make the default file skip the settings.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="usr_51.html#:CompilerSet" name=":CompilerSet">:CompilerSet</a><br>
The second mechanism is to use &quot;:set&quot; for &quot;:compiler!&quot; and &quot;:setlocal&quot; for<br>
&quot;:compiler&quot;.&nbsp;&nbsp;Vim defines the &quot;:CompilerSet&quot; user command for this.&nbsp;&nbsp;However,<br>
older Vim versions don't, thus your plugin should define it then.&nbsp;&nbsp;This is an<br>
example:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;if exists(&quot;:CompilerSet&quot;) != 2<br>
&nbsp;&nbsp;&nbsp;&nbsp;command -nargs=* CompilerSet setlocal &lt;args&gt;<br>
&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;CompilerSet errorformat&amp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot; use the default 'errorformat'<br>
&nbsp;&nbsp;CompilerSet makeprg=nmake</div>
<br>
When you write a compiler plugin for the Vim distribution or for a system-wide<br>
runtime directory, use the mechanism mentioned above.&nbsp;&nbsp;When<br>
&quot;current_compiler&quot; was already set by a user plugin nothing will be done.<br>
<br>
When you write a compiler plugin to overrule settings from a default plugin,<br>
don't check &quot;current_compiler&quot;.&nbsp;&nbsp;This plugin is supposed to be loaded<br>
last, thus it should be in a directory at the end of&nbsp;<a class="Type" href="options.html#'runtimepath'">'runtimepath'</a>.&nbsp;&nbsp;For Unix<br>
that could be ~/.vim/after/compiler.<br>
<br>
<span class="PreProc">==============================================================================</span><br>
<a class="Constant" href="usr_51.html#51.4" name="51.4">51.4</a>&nbsp;&nbsp;Distributing Vim scripts&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="usr_51.html#distribute-script" name="distribute-script">distribute-script</a><br>
<br>
Vim users will look for scripts on the Vim website:&nbsp;<span class="Constant"><a href="http://www.vim.org">http://www.vim.org</a></span>.<br>
If you made something that is useful for others, share it!<br>
<br>
Another place is github.&nbsp;&nbsp;But there you need to know where to find it!&nbsp;&nbsp;The<br>
advantage is that most plugin managers fetch plugins from github.&nbsp;&nbsp;You'll have<br>
to use your favorite search engine to find them.<br>
<br>
Vim scripts can be used on any system.&nbsp;&nbsp;However, there might not be a tar or<br>
gzip command.&nbsp;&nbsp;If you want to pack files together and/or compress them the<br>
&quot;zip&quot; utility is recommended.<br>
<br>
For utmost portability use Vim itself to pack scripts together.&nbsp;&nbsp;This can be<br>
done with the Vimball utility.&nbsp;&nbsp;See&nbsp;<a class="Identifier" href="pi_vimball.html#vimball">vimball</a>.<br>
<br>
It's good if you add a line to allow automatic updating.&nbsp;&nbsp;See&nbsp;<a class="Identifier" href="pi_getscript.html#glvs-plugins">glvs-plugins</a>.<br>
<br>
<span class="PreProc">==============================================================================</span><br>
<br>
Next chapter:&nbsp;<a class="Identifier" href="usr_52.html">usr_52.txt</a>&nbsp;&nbsp;Write large plugins<br>
<br>
Copyright: see&nbsp;<a class="Identifier" href="usr_01.html#manual-copyright">manual-copyright</a>&nbsp;&nbsp;vim:tw=78:ts=8:noet:ft=help:norl:<br>
</div>
